{"name":"Httpretty","tagline":"HTTP client mocking tool for Python","body":"# HTTPretty\r\n> Version 0.5.14\r\n\r\n[![Build Status](https://secure.travis-ci.org/gabrielfalcao/HTTPretty.png)](http://travis-ci.org/gabrielfalcao/HTTPretty)\r\n\r\n### New in version 0.5.14\r\n\r\n* Delegate calls to other methods on socket\r\n\r\n* [Normalized header](https://github.com/gabrielfalcao/HTTPretty/pull/49) strings\r\n\r\n* Callbacks are [more intelligent now](https://github.com/gabrielfalcao/HTTPretty/pull/47)\r\n\r\n* Normalize urls matching for url quoting\r\n\r\n### New in version 0.5.12\r\n\r\n* HTTPretty doesn't hang when using other application protocols under\r\n  a @httprettified decorated test.\r\n\r\n### New in version 0.5.11\r\n\r\n* Ability to know whether HTTPretty is or not enabled through `HTTPretty.is_enabled()`\r\n\r\n### New in version 0.5.10\r\n\r\n* Support to multiple methods per registered URL. Thanks @hughsaunders\r\n\r\n### New in version 0.5.9\r\n\r\n* Fixed python 3 support. Thanks @spulec\r\n\r\n### New in version 0.5.8\r\n\r\n* Support to [register regular expressions to match urls](#matching-regular-expressions)\r\n* [Body callback](#dynamic-responses-through-callbacks) suppport\r\n* Python 3 support\r\n\r\n\r\n# In a nutshell\r\n\r\nOnce upon a time a python developer wanted to use a RESTful api,\r\neverything was fine but until the day he needed to test the code that\r\nhits the RESTful API: what if the API server is down? What if its\r\ncontent has changed ?\r\n\r\nDon't worry, HTTPretty is here for you:\r\n\r\n```python\r\nimport requests\r\nfrom sure import expect\r\nfrom httpretty import HTTPretty\r\nfrom httpretty import httprettified\r\n\r\n\r\n@httprettified\r\ndef test_yipit_api_returning_deals():\r\n    HTTPretty.register_uri(HTTPretty.GET, \"http://api.yipit.com/v1/deals/\",\r\n                           body='[{\"title\": \"Test Deal\"}]',\r\n                           content_type=\"application/json\")\r\n\r\n    response = requests.get('http://api.yipit.com/v1/deals/')\r\n\r\n    expect(response.json()).to.equal([{\"title\": \"Test Deal\"}])\r\n```\r\n\r\n# A more technical description\r\n\r\nHTTPretty is a HTTP client mock library for Python 100% inspired on ruby's [FakeWeb](http://fakeweb.rubyforge.org/).\r\nIf you come from ruby this would probably sound familiar :smiley:\r\n\r\n# Usage\r\n\r\n## expecting a simple response body\r\n\r\n```python\r\nimport requests\r\nfrom httpretty import HTTPretty\r\n\r\ndef test_one():\r\n    HTTPretty.enable()  # enable HTTPretty so that it will monkey patch the socket module\r\n    HTTPretty.register_uri(HTTPretty.GET, \"http://yipit.com/\",\r\n                           body=\"Find the best daily deals\")\r\n\r\n    response = requests.get('http://yipit.com')\r\n\r\n    assert response.text == \"Find the best daily deals\"\r\n\r\n    HTTPretty.disable()  # disable afterwards, so that you will have no problems in code that uses that socket module\r\n```\r\n\r\n## testing query strings\r\n\r\n```python\r\nimport requests\r\nfrom sure import expect\r\nfrom httpretty import HTTPretty\r\n\r\ndef test_one():\r\n    HTTPretty.enable()  # enable HTTPretty so that it will monkey patch the socket module\r\n    HTTPretty.register_uri(HTTPretty.GET, \"http://yipit.com/login\",\r\n                           body=\"Find the best daily deals\")\r\n\r\n    requests.get('http://yipit.com/login?email=user@github.com&password=foobar123')\r\n    expect(HTTPretty.last_request).to.have.property(\"querystring\").being.equal({\r\n        \"email\": \"user@github.com\",\r\n        \"password\": \"foobar123\",\r\n    })\r\n\r\n    HTTPretty.disable()  # disable afterwards, so that you will have no problems in code that uses that socket module\r\n```\r\n\r\n\r\n## ohhhh, really? can that be easier?\r\n\r\n**YES** we've got a decorator\r\n\r\n```python\r\nimport requests\r\nfrom httpretty import HTTPretty, httprettified\r\n\r\n@httprettified\r\ndef test_one():\r\n    HTTPretty.register_uri(HTTPretty.GET, \"http://yipit.com/\",\r\n                           body=\"Find the best daily deals\")\r\n\r\n    response = requests.get('http://yipit.com')\r\n    assert response.text == \"Find the best daily deals\"\r\n```\r\n\r\nthe `@httprettified` is a short-hand decorator that wraps the\r\ndecorated function with HTTPretty.enable() and then calls\r\nHTTPretty.disable() right after.\r\n\r\n## mocking the status code\r\n\r\n```python\r\nimport requests\r\nfrom sure import expect\r\nfrom httpretty import HTTPretty, httprettified\r\n\r\n@httprettified\r\ndef test_github_access():\r\n    HTTPretty.register_uri(HTTPretty.GET, \"http://github.com/\",\r\n                           body=\"here is the mocked body\",\r\n                           status=201)\r\n\r\n    response = requests.get('http://github.com')\r\n    expect(response.status_code).to.equal(201)\r\n```\r\n\r\n## you can tell HTTPretty to return any HTTP headers you want\r\n\r\n**and all you need is to add keyword args in which the keys are always lower-cased and with underscores `_` instead of dashes `-`**\r\n\r\nFor example, let's say you want to mock that server returns `content-type`.\r\nTo do so, use the argument `content_type`, **all the keyword args are taken by HTTPretty and transformed in the RFC2616 equivalent name**.\r\n\r\n```python\r\n@httprettified\r\ndef test_some_api():\r\n    HTTPretty.register_uri(HTTPretty.GET, \"http://foo-api.com/gabrielfalcao\",\r\n                           body='{\"success\": false}',\r\n                           status=500,\r\n                           content_type='text/json')\r\n\r\n    response = requests.get('http://foo-api.com/gabrielfalcao')\r\n\r\n    expect(response.json()).to.equal({'success': False})\r\n    expect(response.status_code).to.equal(500)\r\n```\r\n\r\n## rotating responses\r\n\r\nSame URL, same request method, the first request return the first\r\nHTTPretty.Response, all the subsequent ones return the last (status 202).\r\n\r\nNotice that the `responses` argument is a list and you can pass as\r\nmany responses as you want.\r\n\r\n```python\r\nimport requests\r\nfrom sure import expect\r\n\r\n\r\n@httprettified\r\ndef test_rotating_responses():\r\n    HTTPretty.register_uri(HTTPretty.GET, \"http://github.com/gabrielfalcao/httpretty\",\r\n                           responses=[\r\n                               HTTPretty.Response(body=\"first response\", status=201),\r\n                               HTTPretty.Response(body='second and last response', status=202),\r\n                            ])\r\n\r\n    response1 = requests.get('http://github.com/gabrielfalcao/httpretty')\r\n    expect(response1.status_code).to.equal(201)\r\n    expect(response1.text).to.equal('first response')\r\n\r\n    response2 = requests.get('http://github.com/gabrielfalcao/httpretty')\r\n    expect(response2.status_code).to.equal(202)\r\n    expect(response2.text).to.equal('second and last response')\r\n\r\n    response3 = requests.get('http://github.com/gabrielfalcao/httpretty')\r\n\r\n    expect(response3.status_code).to.equal(202)\r\n    expect(response3.text).to.equal('second and last response')\r\n```\r\n## streaming responses\r\n\r\nMock a streaming response by registering a generator response body.\r\n\r\n```python\r\nimport requests\r\nfrom sure import expect\r\nfrom httpretty import HTTPretty, httprettified\r\n\r\n# mock a streaming response body with a generator\r\ndef mock_streaming_tweets(tweets):\r\n    from time import sleep\r\n    for t in tweets:\r\n        sleep(.5)\r\n        yield t\r\n\r\n@httprettified\r\ndef test_twitter_api_integration(now):\r\n    twitter_response_lines = [\r\n        '{\"text\":\"If @BarackObama requests to follow me one more time I\\'m calling the police.\"}\\r\\n',\r\n        '\\r\\n',\r\n        '{\"text\":\"Thanks for all your #FollowMe1D requests Directioners! We\\u2019ll be following 10 people throughout the day starting NOW. G ...\"}\\r\\n'\r\n    ]\r\n\r\n    TWITTER_STREAMING_URL = \"https://stream.twitter.com/1/statuses/filter.json\"\r\n\r\n    # set the body to a generator and set `streaming=True` to mock a streaming response body\r\n    HTTPretty.register_uri(HTTPretty.POST, TWITTER_STREAMING_URL,\r\n                           body=mock_streaming_tweets(twitter_response_lines),\r\n                           streaming=True)\r\n\r\n    # taken from the requests docs\r\n    # http://docs.python-requests.org/en/latest/user/advanced/#streaming-requests\r\n    response = requests.post(TWITTER_STREAMING_URL, data={'track':'requests'},\r\n                            auth=('username','password'), prefetch=False)\r\n\r\n    #test iterating by line\r\n    line_iter = response.iter_lines()\r\n    for i in xrange(len(twitter_response_lines)):\r\n        expect(line_iter.next().strip()).to.equal(twitter_response_lines[i].strip())\r\n```\r\n\r\n## dynamic responses through callbacks\r\n\r\nSet a callback to allow for dynamic responses based on the request.\r\n\r\n```python\r\nimport requests\r\nfrom sure import expect\r\nfrom httpretty import HTTPretty, httprettified\r\n\r\n@httprettified\r\ndef test_response_callbacks():\r\n\r\n    def request_callback(method, uri, headers):\r\n        return \"The {} response from {}\".format(method, uri)\r\n\r\n    HTTPretty.register_uri(\r\n        HTTPretty.GET, \"https://api.yahoo.com/test\",\r\n        body=request_callback)\r\n\r\n    response = requests.get('https://api.yahoo.com/test')\r\n\r\n    expect(response.text).to.equal('The GET response from https://api.yahoo.com/test')\r\n```\r\n\r\n## matching regular expressions\r\n\r\nYou can register a\r\n[compiled regex](http://docs.python.org/2/library/re.html#re.compile)\r\nand it will be matched against the requested urls.\r\n\r\n```python\r\n@httprettified\r\ndef test_httpretty_should_allow_registering_regexes():\r\n    u\"HTTPretty should allow registering regexes\"\r\n\r\n    HTTPretty.register_uri(\r\n        HTTPretty.GET,\r\n        re.compile(\"api.yipit.com/v2/deal;brand=(\\w+)\"),\r\n        body=\"Found brand\",\r\n    )\r\n\r\n    response = requests.get('https://api.yipit.com/v2/deal;brand=GAP')\r\n    expect(response.text).to.equal('Found brand')\r\n    expect(HTTPretty.last_request.method).to.equal('GET')\r\n    expect(HTTPretty.last_request.path).to.equal('/v1/deal;brand=GAP')\r\n```\r\n\r\n## expect for a response, and check the request got by the \"server\" to make sure it was fine.\r\n\r\n```python\r\nimport requests\r\nfrom sure import expect\r\nfrom httpretty import HTTPretty, httprettified\r\n\r\n\r\n@httprettified\r\ndef test_yipit_api_integration():\r\n    HTTPretty.register_uri(HTTPretty.POST, \"http://api.yipit.com/foo/\",\r\n                           body='{\"repositories\": [\"HTTPretty\", \"lettuce\"]}')\r\n\r\n    response = requests.post('http://api.yipit.com/foo',\r\n                            '{\"username\": \"gabrielfalcao\"}',\r\n                            headers={\r\n                                'content-type': 'text/json',\r\n                            })\r\n\r\n    expect(response.text).to.equal('{\"repositories\": [\"HTTPretty\", \"lettuce\"]}')\r\n    expect(HTTPretty.last_request.method).to.equal(\"POST\")\r\n    expect(HTTPretty.last_request.headers['content-type']).to.equal('text/json')\r\n```\r\n\r\n## checking if is enabled\r\n\r\n```python\r\n\r\nHTTPretty.enable()\r\nHTTPretty.is_enabled().should.be.true\r\n\r\nHTTPretty.disable()\r\nHTTPretty.is_enabled().should.be.false\r\n\r\n```\r\n# Motivation\r\n\r\nWhen building systems that access external resources such as RESTful\r\nwebservices, XMLRPC or even simple HTTP requests, we stumble in the\r\nproblem:\r\n\r\n    \"I'm gonna need to mock all those requests\"\r\n\r\nIt brings a lot of hassle, you will need to use a generic mocking\r\ntool, mess with scope and so on.\r\n\r\n## The idea behind HTTPretty (how it works)\r\n\r\nHTTPretty [monkey patches](http://en.wikipedia.org/wiki/Monkey_patch)\r\nPython's [socket](http://docs.python.org/library/socket.html) core\r\nmodule, reimplementing the HTTP protocol, by mocking requests and\r\nresponses.\r\n\r\nAs for it works in this way, you don't need to worry what http library\r\nyou're gonna use.\r\n\r\nHTTPretty will mock the response for you :) *(and also give you the latest requests so that you can check them)*\r\n\r\n# Acknowledgements\r\n\r\n## caveats with the [requests](http://docs.python-requests.org/en/latest/) library\r\n\r\n### `forcing_headers` + `Content-Length`\r\n\r\nif you use the `forcing_headers` options make sure to add the header\r\n`Content-Length` otherwise the\r\n[requests](http://docs.python-requests.org/en/latest/) will try to\r\nload the response endlessly\r\n\r\n# Officially supported libraries\r\n\r\nBecause HTTPretty works in the socket level it should work with any HTTP client libraries, although it is [battle tested](https://github.com/gabrielfalcao/HTTPretty/tree/master/tests/functional) against:\r\n\r\n* [requests](http://docs.python-requests.org/en/latest/)\r\n* [httplib2](http://code.google.com/p/httplib2/)\r\n* [urllib2](http://docs.python.org/2/library/urllib2.html)\r\n\r\n# Hacking on HTTPretty\r\n\r\n#### create a virtual env\r\n\r\nyou will need [virtualenvwrapper](http://www.doughellmann.com/projects/virtualenvwrapper/)\r\n\r\n\r\n```console\r\nmkvirtualenv --distribute --no-site-packages HTTPretty\r\n```\r\n\r\n#### install the dependencies\r\n\r\n```console\r\npip install -r requirements.pip\r\n```\r\n\r\n#### next steps:\r\n\r\n1. run the tests with make:\r\n```bash\r\nmake unit functional\r\n```\r\n2. hack at will\r\n3. commit, push etc\r\n4. send a pull request\r\n\r\n# License\r\n\r\n    <HTTPretty - HTTP client mock for Python>\r\n    Copyright (C) <2011-2013>  Gabriel Falcão <gabriel@nacaolivre.org>\r\n\r\n    Permission is hereby granted, free of charge, to any person\r\n    obtaining a copy of this software and associated documentation\r\n    files (the \"Software\"), to deal in the Software without\r\n    restriction, including without limitation the rights to use,\r\n    copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n    copies of the Software, and to permit persons to whom the\r\n    Software is furnished to do so, subject to the following\r\n    conditions:\r\n\r\n    The above copyright notice and this permission notice shall be\r\n    included in all copies or substantial portions of the Software.\r\n\r\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\n    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\r\n    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\r\n    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n    OTHER DEALINGS IN THE SOFTWARE.\r\n\r\n\r\n# Main contributors\r\n\r\nThere folks made a remarkable contribution to HTTPretty:\r\n\r\n* Steve Pulec ~> @spulec\r\n* Hugh Saunders ~> @hughsaunders\r\n* Matt Luongo ~> @mhluongo\r\n* James Rowe ~> @JNRowe\r\n","google":"UA-1277640-14 ","note":"Don't delete this file! It's used internally to help with page regeneration."}